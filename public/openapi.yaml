openapi: "3.0.2"
info:
  title: API docs for recruitment task
  version: "1.0"
servers:
  - url: http://localhost
paths:
  /cart/add:
    post:
      summary: Add a product to the cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_code
                - quantity
              properties:
                product_code:
                  type: string
                  example: "first"
                quantity:
                  type: integer
                  minimum: 1
                  maximum: 20
                  example: 2
      responses:
        '201':
          description: Product added to cart successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Product added to cart successfully."
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error (quantity limits)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}:
    get:
      summary: Get order details with promotions and totals
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/promotions/{promotionId}:
    post:
      summary: Assign a promotion to an order
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
        - name: promotionId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Promotion assigned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Promotion assigned to order successfully."
        '404':
          description: Order or Promotion not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error (unsupported promotion type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResponse'

  /openapi:
    get:
      summary: Get OpenAPI specification
      responses:
        '200':
          description: OpenAPI YAML document
          content:
            application/yaml:
              schema:
                type: string

components:
  schemas:
    Order:
      type: object
      properties:
        id:
          type: integer
        itemsTotal:
          type: integer
          description: Sum of all items values (including items discounts)
        adjustmentsTotal:
          type: integer
          description: Sum of all additional fees or discounts (discounts are represented as negative value)
        taxTotal:
          type: integer
          nullable: true
          description: Sum of items tax values (if all items are tax-free the value should be null)
        total:
          type: integer
          description: Final price to pay (sum of "itemsTotal" and "adjustmentsTotal")
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'

    OrderItem:
      type: object
      properties:
        id:
          type: integer
        product:
          $ref: '#/components/schemas/Product'
        unitPrice:
          type: integer
          description: Price of a single item
        discount:
          type: integer
          nullable: true
          description: Percentage value of assigned discount to this item (null if there is no discount)
        discountValue:
          type: integer
          description: Discounted amount assigned to the single item
        distributedOrderDiscountValue:
          type: integer
          description: Discount amount for the entire order divided into one item
        discountedUnitPrice:
          type: integer
          description: Price for a single item with all discounts applied
        quantity:
          type: integer
          description: Number of product's items
        total:
          type: integer
          description: Discounted unit price multiplied by the number of items
        taxValue:
          type: integer
          nullable: true
          description: Amount of tax calculated from "total" and product's tax rate (null if tax-free)

    Product:
      type: object
      description: Details of the product assigned to the item
      properties:
        code:
          type: string
        name:
          type: string

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message

    ValidationResponse:
      type: object
      properties:
        violations:
          type: array
          items:
            type: string
      required:
        - violations
